name: Run Tests

on:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r tests/requirements.txt  # Install test dependencies

      - name: Create settings.json
        run: |
          echo '{
            "BASE_URL": "http://localhost:5009",
            "USERNAME": "testuser",
            "ACCESSKEY": "testaccesskey",
            "SECRET_KEY": "your-secret-key",
            "STORAGE_DIRPATH": "/path/to/storage",
            "SERVER_NAME": "localhost:5009"
          }' > tests/settings.json

      - name: Install Playwright browsers
        run: |
          playwright install  # Install necessary browsers for Playwright

      - name: Start server
        run: |
          nohup python -m http.server 5009 &  # Start a simple HTTP server in the background
          sleep 5  # Wait for the server to start

      - name: Run tests
        run: |
          pytest tests/test_browser_anonymous.py  # Run only the specified test file 